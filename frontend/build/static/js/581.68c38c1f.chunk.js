"use strict";(self.webpackChunkflatmates_frontend=self.webpackChunkflatmates_frontend||[]).push([[581],{581:(e,t,n)=>{n.d(t,{Messages:()=>ne});var r=n(5043),s=n(9456),i=n(3216),o=n(2104),a=n(8012),l=n(5539);let c=null;const d=e=>{const t=localStorage.getItem("token");return t?((e,t)=>(c&&c.close(),c=(0,o.Ay)("/",{auth:{token:e},transports:["websocket"]}),c.on("connect",()=>{console.log("Socket connected")}),c.on("disconnect",()=>{console.log("Socket disconnected")}),c.on("error",e=>{console.error("Socket error:",e),t((0,l.S7)("error","Connection error. Please try again."))}),c.on("message",e=>{t((0,a.VI)({message:e.message,conversationId:e.conversationId}))}),c.on("messageRead",e=>{t((0,a.$G)(e.conversationId))}),c.on("unreadCount",e=>{t((0,a.Sy)(e.count))}),c))(t,e):null},x=()=>{c&&(c.close(),c=null)},h=e=>{c&&c.emit("joinConversation",{conversationId:e})},m=e=>{c&&c.emit("leaveConversation",{conversationId:e})},u=(e,t)=>{c&&c.emit("typing",{conversationId:e,isTyping:t})},p=e=>{c&&c.emit("markAsRead",{conversationId:e})};var g=n(4021),j=n(8202),y=n(6446),A=n(5865),f=n(5721),v=n(4628),b=n(3851),S=n(8734),w=n(8266),C=n(1045),k=n(9336),I=n(8739),D=n(7392),_=n(378),T=n(1449),z=n(3336),E=n(2559),W=n(8185),L=n(3845),R=n(1906),N=n(6360),P=n(8082),M=n(5048),O=n(3471),F=n(3639),J=n(2505),U=n(579);const B=()=>{const e=(0,j.jL)(),t=(0,i.Zp)(),n=(0,i.zy)(),{user:o}=(0,s.d4)(e=>e.auth),{conversations:l,loading:c}=(0,s.d4)(e=>e.message),[d,x]=(0,r.useState)(""),[h,m]=(0,r.useState)(null),[u,B]=(0,r.useState)(null),[H,V]=(0,r.useState)(!1);(0,r.useEffect)(()=>{e((0,a.lS)())},[e]);const $=()=>{m(null),B(null)},G=e=>{if(!e)return"";const t=new Date(e),n=(new Date).getTime()-t.getTime(),r=Math.floor(n/6e4),s=Math.floor(r/60),i=Math.floor(s/24);return r<1?"Just now":r<60?"".concat(r,"m ago"):s<24?"".concat(s,"h ago"):i<7?"".concat(i,"d ago"):t.toLocaleDateString([],{month:"short",day:"numeric"})},K=e=>e.participants.find(e=>e._id!==(null===o||void 0===o?void 0:o._id)),Z=l.filter(e=>{const t=K(e);return!(!t||!t.name)&&t.name.toLowerCase().includes(d.toLowerCase())}),q=e=>{const s=K(e);if(!s)return null;const i=n.pathname==="/messages/".concat(e._id),o=e.lastMessage;return(0,U.jsxs)(r.Fragment,{children:[(0,U.jsxs)(v.Ay,{button:!0,alignItems:"flex-start",onClick:()=>{return n=e._id,t("/messages/".concat(n)),void p(n);var n},sx:{bgcolor:i?"action.selected":"inherit","&:hover":{bgcolor:i?"action.selected":"action.hover"},py:1.5},children:[(0,U.jsx)(b.A,{children:(0,U.jsx)(I.A,{color:"primary",badgeContent:e.unreadCount,invisible:0===e.unreadCount,overlap:"circular",children:(0,U.jsx)(C.A,{alt:s.name,src:s.avatar})})}),(0,U.jsx)(S.A,{primary:(0,U.jsxs)(y.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,U.jsx)(A.A,{variant:"subtitle1",sx:{fontWeight:e.unreadCount>0?"bold":"normal",color:e.unreadCount>0?"text.primary":"inherit"},children:s.name}),(0,U.jsx)(A.A,{variant:"caption",color:"text.secondary",children:G(null===o||void 0===o?void 0:o.createdAt)})]}),secondary:(0,U.jsxs)(y.A,{children:[(0,U.jsx)(A.A,{variant:"body2",color:"text.secondary",sx:{display:"inline",fontWeight:e.unreadCount>0?"medium":"normal",color:e.unreadCount>0?"text.primary":"inherit"},noWrap:!0,children:o?o.attachments&&o.attachments.length>0?(0,U.jsx)(y.A,{component:"span",sx:{display:"flex",alignItems:"center"},children:o.content?o.content:"Sent an attachment"}):null===o||void 0===o?void 0:o.content:"No messages yet"}),e.property&&(0,U.jsx)(L.A,{icon:(0,U.jsx)(F.A,{fontSize:"small"}),label:e.property.title.substring(0,15)+(e.property.title.length>15?"...":""),size:"small",sx:{mt:.5,maxWidth:"100%"}})]})}),(0,U.jsx)(w.A,{children:(0,U.jsx)(D.A,{edge:"end",onClick:t=>((e,t)=>{e.stopPropagation(),m(e.currentTarget),B(t)})(t,e),size:"small",children:(0,U.jsx)(P.A,{})})})]}),(0,U.jsx)(k.A,{component:"li"})]},e._id)};return(0,U.jsxs)(y.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,U.jsxs)(y.A,{sx:{display:"flex",mb:2,gap:1},children:[(0,U.jsxs)(z.A,{component:"form",sx:{p:"2px 4px",display:"flex",alignItems:"center",boxShadow:1,flexGrow:1},children:[(0,U.jsx)(D.A,{sx:{p:"10px"},"aria-label":"search",children:(0,U.jsx)(N.A,{})}),(0,U.jsx)(E.Ay,{sx:{ml:1,flex:1},placeholder:"Search conversations",value:d,onChange:e=>x(e.target.value)})]}),(0,U.jsx)(R.A,{variant:"contained",color:"primary",startIcon:(0,U.jsx)(J.A,{}),onClick:()=>V(!0),children:"New"})]}),(0,U.jsx)(z.A,{elevation:2,sx:{flexGrow:1,overflow:"auto",maxHeight:"calc(100vh - 240px)"},children:c?(0,U.jsx)(f.A,{children:[...Array(5)].map((e,t)=>(0,U.jsxs)(r.Fragment,{children:[(0,U.jsxs)(v.Ay,{alignItems:"flex-start",children:[(0,U.jsx)(b.A,{children:(0,U.jsx)(W.A,{variant:"circular",width:40,height:40})}),(0,U.jsx)(S.A,{primary:(0,U.jsx)(W.A,{width:"70%"}),secondary:(0,U.jsxs)(r.Fragment,{children:[(0,U.jsx)(W.A,{width:"90%"}),(0,U.jsx)(W.A,{width:"40%"})]})})]}),(0,U.jsx)(k.A,{component:"li"})]},t))}):0===Z.length?(0,U.jsx)(y.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",p:3},children:(0,U.jsx)(A.A,{variant:"body1",color:"text.secondary",align:"center",children:d?"No conversations match your search":"No conversations yet"})}):(0,U.jsx)(f.A,{sx:{width:"100%",bgcolor:"background.paper",p:0},children:Z.map(e=>q(e))})}),(0,U.jsxs)(_.A,{anchorEl:h,open:Boolean(h),onClose:$,children:[(0,U.jsxs)(T.A,{onClick:()=>{u&&(e((0,a.gk)(u._id)),$())},children:[(0,U.jsx)(M.A,{fontSize:"small",sx:{mr:1}}),"Archive"]}),(0,U.jsxs)(T.A,{onClick:$,children:[(0,U.jsx)(O.A,{fontSize:"small",sx:{mr:1}}),"Delete"]})]}),(0,U.jsx)(g.A,{open:H,onClose:()=>V(!1)})]})};var H=n(7784),V=n(1637),$=n(2110),G=n(6591),K=n(6494),Z=n(5678),q=n(9167),Y=n(7199),Q=n(9120);const X=()=>{var e;const{id:t}=(0,i.g)(),n=(0,i.Zp)(),o=(0,s.wA)(),{user:l}=(0,s.d4)(e=>e.auth),{currentConversation:c,messages:d,loading:x}=(0,s.d4)(e=>e.message),[g,j]=(0,r.useState)(""),[f,v]=(0,r.useState)([]),[b,S]=(0,r.useState)(!1),[w,I]=(0,r.useState)(null),[_,T]=(0,r.useState)(!1),E=(0,r.useRef)(null),W=(0,r.useRef)(null),L=null===c||void 0===c||null===(e=c.participants)||void 0===e?void 0:e.find(e=>e._id!==(null===l||void 0===l?void 0:l._id));(0,r.useEffect)(()=>{if(t)return o((0,a.VL)(t)),h(t),p(t),()=>{m(t)}},[o,t]),(0,r.useEffect)(()=>{N()},[d]),(0,r.useEffect)(()=>{g&&!b&&(S(!0),u(t,!0)),w&&clearTimeout(w);const e=setTimeout(()=>{b&&(S(!1),u(t,!1))},2e3);return I(e),()=>{w&&clearTimeout(w)}},[g,b,t,w]);const N=()=>{var e;null===(e=E.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},P=async()=>{if((g.trim()||0!==f.length)&&!_){T(!0);try{await o((0,a._z)({conversationId:t,content:g.trim(),attachments:f})),j(""),v([])}catch(e){console.error("Error sending message:",e)}finally{T(!1)}}},M=e=>{const t=new Date(e),n=new Date,r=new Date(n);return r.setDate(r.getDate()-1),t.toDateString()===n.toDateString()?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t.toDateString()===r.toDateString()?"Yesterday, ".concat(t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})):t.toLocaleDateString([],{month:"short",day:"numeric"})+", "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},O=e=>{const t=new Date(e),n=new Date,r=new Date(n);return r.setDate(r.getDate()-1),t.toDateString()===n.toDateString()?"Today":t.toDateString()===r.toDateString()?"Yesterday":t.toLocaleDateString([],{weekday:"long",month:"long",day:"numeric"})},F=(e,t)=>{const n=e.type.startsWith("image/");return(0,U.jsxs)(y.A,{sx:{position:"relative",display:"inline-block",m:.5,borderRadius:1,overflow:"hidden",border:"1px solid",borderColor:"divider"},children:[n?(0,U.jsx)(y.A,{component:"img",src:URL.createObjectURL(e),alt:"Attachment preview",sx:{width:80,height:80,objectFit:"cover"}}):(0,U.jsx)(y.A,{sx:{width:80,height:80,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"action.hover"},children:(0,U.jsx)(Y.A,{})}),(0,U.jsx)(D.A,{size:"small",sx:{position:"absolute",top:0,right:0,bgcolor:"rgba(0,0,0,0.5)",color:"white","&:hover":{bgcolor:"rgba(0,0,0,0.7)"},p:.2},onClick:()=>(e=>{v(f.filter((t,n)=>n!==e))})(t),children:"\xd7"}),(0,U.jsx)(A.A,{variant:"caption",sx:{position:"absolute",bottom:0,left:0,right:0,bgcolor:"rgba(0,0,0,0.5)",color:"white",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",px:1},children:e.name.length>10?"".concat(e.name.substring(0,7),"..."):e.name})]},t)};return x&&!c?(0,U.jsx)(y.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:(0,U.jsx)(V.A,{})}):(0,U.jsxs)(y.A,{sx:{height:"calc(100vh - 180px)",display:"flex",flexDirection:"column"},children:[(0,U.jsx)(z.A,{elevation:2,sx:{p:2,mb:2},children:(0,U.jsxs)(y.A,{sx:{display:"flex",alignItems:"center"},children:[(0,U.jsx)(D.A,{sx:{mr:1},onClick:()=>n("/messages"),children:(0,U.jsx)(Q.A,{})}),L&&(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(C.A,{src:L.avatar,alt:L.name,sx:{mr:2}}),(0,U.jsxs)(y.A,{children:[(0,U.jsx)(A.A,{variant:"h6",children:L.name}),(0,U.jsx)(A.A,{variant:"body2",color:"text.secondary",children:null!==L&&void 0!==L&&L.userType?L.userType.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"User"})]})]})]})}),(()=>{if(null===c||void 0===c||!c.property)return null;const e=c.property;return(0,U.jsxs)($.A,{sx:{mb:2},children:[(0,U.jsx)(G.A,{component:"img",height:"140",image:e.images&&e.images.length>0?e.images[0]:"https://picsum.photos/seed/no-image-convo/300/140",alt:e.title}),(0,U.jsxs)(K.A,{children:[(0,U.jsx)(A.A,{variant:"h6",component:"div",noWrap:!0,children:e.title}),(0,U.jsxs)(A.A,{variant:"body2",color:"text.secondary",children:[e.address.city,", ",e.address.state]}),(0,U.jsxs)(A.A,{variant:"body1",sx:{mt:1},children:["$",e.price.amount,e.price.brokerage&&e.price.brokerage>0?(0,U.jsxs)("span",{children:[" (Brokerage: ",e.price.brokerage,")"]}):null]}),(0,U.jsx)(R.A,{size:"small",sx:{mt:1},onClick:()=>n("/properties/".concat(e._id)),children:"View Property"})]})]})})(),(0,U.jsx)(z.A,{elevation:2,sx:{p:2,mb:2,flexGrow:1,overflow:"auto",display:"flex",flexDirection:"column"},children:x?(0,U.jsx)(y.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:(0,U.jsx)(V.A,{})}):0===d.length?(0,U.jsx)(y.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:(0,U.jsx)(A.A,{variant:"body1",color:"text.secondary",children:"No messages yet. Start the conversation!"})}):(0,U.jsxs)(U.Fragment,{children:[Object.entries((()=>{const e={};return d.forEach(t=>{const n=new Date(t.createdAt).toDateString();e[n]||(e[n]=[]),e[n].push(t)}),e})()).map(e=>{let[t,n]=e;return(0,U.jsxs)(y.A,{children:[(0,U.jsx)(k.A,{sx:{my:2},children:(0,U.jsx)(A.A,{variant:"caption",color:"text.secondary",children:O(t)})}),n.map(e=>{var t;let n;if("string"===typeof e.sender)n=e.sender;else if(e.sender&&"object"===typeof e.sender)if("_id"in e.sender&&e.sender._id)if("string"===typeof e.sender._id)n=e.sender._id;else{const t=JSON.parse(JSON.stringify(e.sender._id));n="string"===typeof t?t:t.$oid||t.toString()}else{const t=JSON.stringify(e.sender);try{const e=JSON.parse(t);n=e.$oid||e.toString()||t.replace(/[{}"]/g,"")}catch(i){n=t.replace(/[{}"]/g,"")}}else n="";const r="object"===typeof e.sender&&null!==(t=e.sender)&&void 0!==t&&t.name?e.sender:null===c||void 0===c?void 0:c.participants.find(e=>e._id===n),s=n===(null===l||void 0===l?void 0:l._id);return(0,U.jsxs)(y.A,{sx:{display:"flex",flexDirection:s?"row-reverse":"row",mb:2},children:[!s&&r&&(0,U.jsx)(C.A,{src:r.avatar,alt:r.name,sx:{mr:1,mt:1}}),(0,U.jsxs)(y.A,{sx:{maxWidth:"70%",bgcolor:s?"primary.light":"background.default",color:s?"primary.contrastText":"text.primary",borderRadius:2,p:2,position:"relative"},children:[e.attachments&&e.attachments.length>0&&(0,U.jsx)(y.A,{sx:{mb:e.content?1:0},children:e.attachments.map(e=>(e=>e.mimetype.startsWith("image/")?(0,U.jsx)(y.A,{component:"img",src:e.url,alt:"Attachment",sx:{maxWidth:"100%",maxHeight:200,borderRadius:1,mb:1}},String(e._id)):(0,U.jsxs)(y.A,{component:"a",href:e.url,target:"_blank",rel:"noopener noreferrer",sx:{display:"flex",alignItems:"center",p:1,mb:1,borderRadius:1,bgcolor:"action.hover",textDecoration:"none",color:"text.primary"},children:[(0,U.jsx)(Y.A,{sx:{mr:1}}),(0,U.jsx)(A.A,{variant:"body2",noWrap:!0,children:e.filename})]},String(e._id)))(e))}),e.content&&(0,U.jsx)(A.A,{variant:"body1",children:e.content}),(0,U.jsxs)(A.A,{variant:"caption",sx:{display:"block",textAlign:"right",mt:.5,color:s?"rgba(255,255,255,0.7)":"text.secondary"},children:[M(e.createdAt),e.read&&s&&(0,U.jsx)("span",{style:{marginLeft:"4px"},children:"\u2713"})]})]})]},(e=>{if("string"===typeof e)return e;if(!e)return Math.random().toString();const t=JSON.parse(JSON.stringify(e));return"string"===typeof t?t:t.$oid||t.toString()})(e._id))})]},t)}),(0,U.jsx)("div",{ref:E})]})}),(0,U.jsxs)(z.A,{elevation:2,sx:{p:2},children:[f.length>0&&(0,U.jsx)(y.A,{sx:{mb:2,display:"flex",flexWrap:"wrap"},children:f.map((e,t)=>F(e,t))}),(0,U.jsxs)(y.A,{sx:{display:"flex",alignItems:"center"},children:[(0,U.jsx)(D.A,{onClick:()=>{var e;return null===(e=W.current)||void 0===e?void 0:e.click()},children:(0,U.jsx)(q.A,{})}),(0,U.jsx)("input",{type:"file",ref:W,style:{display:"none"},onChange:e=>{const t=Array.from(e.target.files||[]);if(0===t.length)return;const n=t.filter(e=>{const t=e.size<=5242880;return t||alert("File size should not exceed 5MB"),t});0!==n.length&&(v([...f,...n]),e.target.value="")},multiple:!0}),(0,U.jsx)(H.A,{fullWidth:!0,placeholder:"Type a message...",variant:"outlined",value:g,onChange:e=>j(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),P())},multiline:!0,maxRows:4,sx:{mx:1}}),(0,U.jsx)(R.A,{variant:"contained",color:"primary",endIcon:(0,U.jsx)(Z.A,{}),onClick:P,disabled:!g.trim()&&0===f.length||_,children:_?(0,U.jsx)(V.A,{size:24}):"Send"})]})]})]})};var ee=n(8903),te=n(6992);const ne=()=>{const e=(0,s.wA)(),t=(0,i.zy)();(0,r.useEffect)(()=>(d(e),()=>{x()}),[e]);const n="/messages"!==t.pathname;return(0,U.jsxs)(y.A,{sx:{py:3},children:[(0,U.jsx)(A.A,{variant:"h4",component:"h1",gutterBottom:!0,children:"Messages"}),(0,U.jsxs)(ee.Ay,{container:!0,spacing:3,children:[(0,U.jsx)(te.A,{smDown:n,children:(0,U.jsx)(ee.Ay,{item:!0,xs:12,md:4,children:(0,U.jsx)(B,{})})}),(0,U.jsx)(ee.Ay,{item:!0,xs:12,md:n?8:12,children:(0,U.jsxs)(i.BV,{children:[(0,U.jsx)(i.qh,{path:"/",element:(0,U.jsx)(te.A,{smUp:!0,children:(0,U.jsx)(B,{})})}),(0,U.jsx)(i.qh,{path:"/:id",element:(0,U.jsx)(X,{})})]})})]})]})}},4021:(e,t,n)=>{n.d(t,{A:()=>T});var r=n(5043),s=n(9456),i=n(3216),o=n(8012),a=n(8202),l=n(9722),c=n(35),d=n(6600),x=n(5316),h=n(9347),m=n(7784),u=n(1906),p=n(3336),g=n(5721),j=n(4628),y=n(3851),A=n(8734),f=n(1045),v=n(5865),b=n(1637),S=n(1787),w=n(3845),C=n(6446),k=n(6360),I=n(2177),D=n(3639),_=n(579);const T=e=>{let{open:t,onClose:n,propertyId:T=null,ownerId:z=null}=e;const E=(0,a.jL)(),W=(0,i.Zp)(),L=(0,i.zy)(),{user:R}=(0,s.d4)(e=>e.auth),[N,P]=(0,r.useState)(""),[M,O]=(0,r.useState)([]),[F,J]=(0,r.useState)(null),[U,B]=(0,r.useState)(""),[H,V]=(0,r.useState)(!1),[$,G]=(0,r.useState)(!1),[K,Z]=(0,r.useState)("");(0,r.useEffect)(()=>{(async()=>{if(z&&!F&&t)try{V(!0);const e=(await l.A.get("/api/users/".concat(z))).data;J(e),T&&!U&&B("Hi! I'm interested in your property. Could you tell me more about it?")}catch(e){console.error("Error fetching owner details:",e),Z("Unable to load property owner information. Please search manually.")}finally{V(!1)}})()},[z,F,t,T,U]),(0,r.useEffect)(()=>{const e=new URLSearchParams(L.search);e.get("propertyId"),e.get("ownerId")},[L.search,T,z]),(0,r.useEffect)(()=>{const e=setTimeout(async()=>{if(N.trim().length<2)O([]);else{G(!0);try{const e=(await l.A.get("/api/users",{params:{search:N}})).data.users.filter(e=>e._id!==(null===R||void 0===R?void 0:R._id));O(e)}catch(e){console.error("Error searching users:",e),O([])}finally{G(!1)}}},300);return()=>clearTimeout(e)},[N,R]),(0,r.useEffect)(()=>{t||(P(""),O([]),J(null),B(""),Z(""))},[t]);const q=()=>{n()};return(0,_.jsxs)(c.A,{open:t,onClose:q,maxWidth:"sm",fullWidth:!0,children:[(0,_.jsxs)(d.A,{children:["New Conversation",T&&(0,_.jsx)(w.A,{icon:(0,_.jsx)(D.A,{}),label:"Property Related",size:"small",color:"primary",sx:{ml:1}})]}),(0,_.jsxs)(x.A,{children:[F?(0,_.jsxs)(C.A,{children:[(0,_.jsxs)(C.A,{sx:{display:"flex",alignItems:"center",mb:2,p:1,bgcolor:"grey.100",borderRadius:1},children:[(0,_.jsx)(f.A,{src:F.avatar,alt:F.name,sx:{mr:2},children:!F.avatar&&(0,_.jsx)(I.A,{})}),(0,_.jsxs)(C.A,{children:[(0,_.jsx)(v.A,{variant:"subtitle1",children:F.name}),(0,_.jsx)(v.A,{variant:"body2",color:"text.secondary",children:F.userType})]}),(0,_.jsx)(u.A,{size:"small",onClick:()=>J(null),sx:{ml:"auto"},children:"Change"})]}),(0,_.jsx)(m.A,{fullWidth:!0,multiline:!0,rows:4,variant:"outlined",placeholder:"Type your message here...",value:U,onChange:e=>B(e.target.value),sx:{mb:2}}),T&&(0,_.jsx)(v.A,{variant:"caption",color:"text.secondary",children:"This conversation is related to a property listing"})]}):(0,_.jsxs)(C.A,{children:[(0,_.jsx)(m.A,{fullWidth:!0,variant:"outlined",placeholder:"Search users by name...",value:N,onChange:e=>P(e.target.value),InputProps:{startAdornment:(0,_.jsx)(S.A,{position:"start",children:(0,_.jsx)(k.A,{})})},sx:{mb:2}}),$&&(0,_.jsx)(C.A,{sx:{display:"flex",justifyContent:"center",my:2},children:(0,_.jsx)(b.A,{size:24})}),M.length>0&&(0,_.jsx)(p.A,{elevation:2,sx:{maxHeight:200,overflow:"auto"},children:(0,_.jsx)(g.A,{children:M.map(e=>(0,_.jsxs)(j.Ay,{button:!0,onClick:()=>(e=>{J(e),P(""),O([]),T&&!U&&B("Hi! I'm interested in your property. Could you tell me more about it?")})(e),children:[(0,_.jsx)(y.A,{children:(0,_.jsx)(f.A,{src:e.avatar,alt:e.name,children:!e.avatar&&(0,_.jsx)(I.A,{})})}),(0,_.jsx)(A.A,{primary:e.name,secondary:e.userType})]},e._id))})}),N.length>=2&&0===M.length&&!$&&(0,_.jsx)(v.A,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",my:2},children:"No users found"})]}),K&&(0,_.jsx)(v.A,{color:"error",variant:"body2",sx:{mt:1},children:K})]}),(0,_.jsxs)(h.A,{children:[(0,_.jsx)(u.A,{onClick:q,children:"Cancel"}),(0,_.jsx)(u.A,{onClick:async()=>{if(F)if(U.trim()){V(!0),Z("");try{const e=await E((0,o.cK)({recipient:F._id,initialMessage:U.trim(),property:T||void 0})).unwrap();n(),W("/messages/".concat(e._id))}catch(e){console.error("Error creating conversation:",e),Z(e.message||"Failed to create conversation")}finally{V(!1)}}else Z("Please enter a message");else Z("Please select a user to message")},variant:"contained",disabled:!F||!U.trim()||H,children:H?(0,_.jsx)(b.A,{size:24}):"Start Conversation"})]})]})}}}]);
//# sourceMappingURL=581.68c38c1f.chunk.js.map